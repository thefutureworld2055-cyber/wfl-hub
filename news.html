<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WFL — News</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .news-grid { display: grid; gap: 14px; }

    .news-card {
      background: #0b1220;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
    }

    .meta { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    .tag {
      display:inline-block;
      font-size:12px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      color:var(--muted);
    }

    .title { margin: 10px 0 8px; }

    .byline {
      font-size: 12px;
      color: var(--muted);
      margin: 2px 0 10px;
    }

    .actions { margin-top: 12px; display:flex; gap:10px; flex-wrap:wrap; }

    .btn {
      display:inline-block;
      padding: 8px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #0f1623;
      color: var(--text);
      text-decoration: none;
      font-weight: 900;
      cursor: pointer;
    }
    .btn:hover { border-color: var(--link); }

    .small { font-size:12px; color: var(--muted); }
    .muted { color: var(--muted); }

    hr.sep { border: 0; border-top: 1px solid var(--border); margin: 14px 0; }

    /* Article formatting */
    .article-body p { line-height: 1.6; margin: 10px 0; }
    .article-top {
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 12px;
    }

    /* Optional: featured look for Pulse */
    .pulse {
      border-color: rgba(147,197,253,0.35);
      box-shadow: 0 0 0 1px rgba(147,197,253,0.08) inset;
    }
  </style>
</head>

<body>
  <header>
    <h1>WFL HUB</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="schedule.html">Schedule</a>
      <a href="news.html">News</a>
      <a href="quiz.html">Quiz</a>
      <a href="fan-activity.html">Fan Activity</a>
      <a href="arcade.html">Arcade</a>
    </nav>
  </header>

  <main class="wrap">
    <div class="card">
      <h2 id="pageTitle">League News</h2>
      <p class="muted" id="pageSub">Posts update between games so the league stays alive.</p>

      <!-- Article view (hidden unless ?id= is present) -->
      <div id="articleView" style="display:none;"></div>

      <!-- Feed view -->
      <div id="feedView" class="news-grid"></div>

      <p class="small" id="status"></p>
    </div>
  </main>

<script>
  const FEED_EL = document.getElementById("feedView");
  const ARTICLE_EL = document.getElementById("articleView");
  const STATUS_EL = document.getElementById("status");

  const pageTitle = document.getElementById("pageTitle");
  const pageSub = document.getElementById("pageSub");

  function prettyDate(iso){
    const [y,m,d] = (iso || "").split("-").map(Number);
    if (!y || !m || !d) return iso || "";
    const dt = new Date(y, m-1, d);
    return dt.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"numeric" });
  }

  function escapeHtml(s){
    return String(s || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function setStatus(msg){ STATUS_EL.textContent = msg || ""; }

  function bylineText(a){
    const writer = a.writer ? `By ${a.writer}` : "";
    const network = a.network ? a.network : "";
    const date = a.date ? prettyDate(a.date) : "";
    // Prefer: By X — Network • Date
    const parts = [];
    if (writer) parts.push(writer);
    if (network) parts.push(network);
    let left = parts.join(" — ");
    if (left && date) return `${left} • ${date}`;
    return left || date || "";
  }

  function renderFeed(items){
    FEED_EL.innerHTML = "";
    items.forEach(a => {
      const card = document.createElement("div");
      const isPulse = (a.category || "").toLowerCase() === "pulse";
      card.className = "news-card" + (isPulse ? " pulse" : "");

      const metaBits = `
        <div class="meta">
          <span class="tag">${escapeHtml(a.category || "News")}</span>
          <span class="small">${escapeHtml(prettyDate(a.date))}</span>
          ${a.network ? `<span class="small">${escapeHtml(a.network)}</span>` : ""}
        </div>
      `;

      card.innerHTML = `
        ${metaBits}
        <h3 class="title">${escapeHtml(a.title)}</h3>
        ${ (a.writer || a.network) ? `<div class="byline">${escapeHtml(bylineText(a))}</div>` : "" }
        <p class="muted">${escapeHtml(a.summary || "")}</p>
        <div class="actions">
          <a class="btn" href="news.html?id=${encodeURIComponent(a.id)}">Read</a>
        </div>
      `;
      FEED_EL.appendChild(card);
    });
  }

  function renderArticle(a){
    const isPulse = (a.category || "").toLowerCase() === "pulse";
    const klass = "news-card" + (isPulse ? " pulse" : "");

    ARTICLE_EL.innerHTML = `
      <div class="${klass}">
        <div class="article-top">
          <div class="meta">
            <span class="tag">${escapeHtml(a.category || "News")}</span>
            <span class="small">${escapeHtml(prettyDate(a.date))}</span>
            ${a.network ? `<span class="small">${escapeHtml(a.network)}</span>` : ""}
          </div>

          <h3 class="title">${escapeHtml(a.title)}</h3>

          ${ (a.writer || a.network || a.date) ? `<div class="byline">${escapeHtml(bylineText(a))}</div>` : "" }

          ${a.summary ? `<p class="muted" style="margin:10px 0 0;">${escapeHtml(a.summary)}</p>` : ""}
        </div>

        <div class="article-body">
          ${(a.body || []).map(p => `<p>${escapeHtml(p)}</p>`).join("")}
        </div>

        <div class="actions">
          <a class="btn" href="news.html">← Back to News</a>
        </div>
      </div>
    `;
  }

  async function main(){
    try{
      setStatus("Loading…");
      const res = await fetch("articles.json", { cache: "no-store" });
      if (!res.ok) throw new Error("Could not load articles.json");
      const items = await res.json();

      // newest first (assumes ISO date)
      items.sort((a,b) => (b.date || "").localeCompare(a.date || ""));

      const params = new URLSearchParams(location.search);
      const id = params.get("id");

      if (id) {
        const article = items.find(x => x.id === id);
        if (!article) {
          pageTitle.textContent = "Article not found";
          pageSub.textContent = "That post may have been removed or renamed.";
          ARTICLE_EL.style.display = "block";
          FEED_EL.style.display = "none";
          ARTICLE_EL.innerHTML = `<div class="news-card">
            <p class="muted">No article found for id: <strong>${escapeHtml(id)}</strong></p>
            <a class="btn" href="news.html">← Back to News</a>
          </div>`;
        } else {
          pageTitle.textContent = "League News";
          pageSub.textContent = "Between-game updates that keep the league alive.";
          ARTICLE_EL.style.display = "block";
          FEED_EL.style.display = "none";
          renderArticle(article);
        }
      } else {
        ARTICLE_EL.style.display = "none";
        FEED_EL.style.display = "grid";
        renderFeed(items);
      }

      setStatus("");
    } catch (e){
      setStatus("❌ News failed to load. Make sure articles.json exists in the same folder as news.html.");
      console.error(e);
    }
  }

  main();
</script>
</body>
</html>
